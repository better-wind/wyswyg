!function(a){function b(b,e,f){function g(){isfirst&&a(".ggl .message img").show(),isfirst=!1}function h(a){a.preventDefault(),mousedown=!0,g()}function i(a){a.preventDefault(),mousedown=!1,j()}function j(){for(var a=0,c=p.getImageData(.1*e,.1*f,.8*e,.8*f),d=c.data.length,g=0;d>g;g++)0==c.data[g]&&a++;a>=d*b&&l&&l()}function k(b){if(b.preventDefault(),mousedown){b.changedTouches&&(b=b.changedTouches[b.changedTouches.length-1]);var c=(b.clientX+a(document).scrollLeft()||b.pageX)-canvasLeft-ggl_navLeft-ggl_navmarginLeft-ggl_wrapmarginLeft-ggl_wrapLeft||0,d=(b.clientY+a(document).scrollTop()||b.pageY)-canvasTop-ggl_navTop-ggl_navmarginTop-ggl_wrapTop-ggl_wrapmarginTop||0;p.beginPath(),p.arc(c,d,15,0,2*Math.PI),p.fill()}}var l,m=a(".ggl"),n=a(".ggl_wrap"),o=document.getElementById("myCanvas"),p=o.getContext("2d"),q=new Image;q.src="../../../build/h5/h5_study/img/heart.png",q.onload=function(){o.width=e,o.height=f,p.drawImage(q,0,0,o.width,o.height),p.globalCompositeOperation="destination-out"},canvasLeft=o.offsetLeft,canvasTop=o.offsetTop,mousedown=!1,isfirst=!0,ggl_navmarginLeft=parseInt(c(m.css("margin-left"))),ggl_navmarginTop=parseInt(c(m.css("margin-top"))),ggl_navLeft=m.position().left,ggl_navTop=m.position().top,ggl_wrapmarginLeft=parseInt(c(n.css("margin-left"))),ggl_wrapmarginTop=parseInt(c(n.css("margin-top"))),ggl_wrapLeft=n.position().left,ggl_wrapTop=n.position().top,o.addEventListener("touchstart",h),o.addEventListener("touchend",i),o.addEventListener("touchmove",k),this.finish=function(a){l=a},this.clear=function(){p.beginPath(),p.rect(0,0,e,f),p.fill(),o.removeEventListener("touchstart",h),o.removeEventListener("touchend",i),o.removeEventListener("touchmove",k),d.last_show()}}function c(a){if(!a)return!1;var b=a.split("px");return b[0]}var d={init:function(){var b=this;b.J_wrap=a(".J_wrap"),b.J_gift_wrap=a(".J_gift_wrap"),b.J_gift_box=a(".J_gift_box"),b.J_gift_box_top=a(".J_gift_box_top"),b.J_gift_box_bottom=a(".J_gift_box_bottom"),b.J_wrap.css("height",a(window).height()),b.J_top=a(".J_top"),b.J_left_open=a(".J_left_open"),b.J_right_open=a(".J_right_open"),b.J_front_open=a(".J_front_open"),b.J_behind_open=a(".J_behind_open"),b.J_love=a(".J_love"),b.J_ggl_wrap=a(".J_ggl_wrap"),b.eventing()},eventing:function(){var a=this;a.text_init(),a.gift_init(),a.snow_init(),a.my_gift_show(),a.ggl_init()},love_heart_show:function(){var b=this;b.J_love.show().addClass("love_show");setTimeout(function(){b.J_love.hide(),a(".message").show(),a("#myCanvas").show()},3e3)},my_gift_show:function(){var b=this;b.J_gift_box.on("click",function(){a(this).removeClass("gift_box_rotate"),b.J_gift_box_top.addClass("gift_box_top_open"),b.J_gift_box_bottom.addClass("gift_box_bottom_open"),b.J_left_open.addClass("left_open"),b.J_right_open.addClass("right_open"),b.J_front_open.addClass("front_open"),b.J_behind_open.addClass("behind_open");setTimeout(function(){b.J_gift_wrap.hide()},1e3),setTimeout(function(){b.love_heart_show(),a(".bg_text").addClass("text_hug")},200)})},gift_init:function(){var a=this;setTimeout(function(){a.J_gift_box.show(),a.J_gift_box.addClass("gift_box_show")},6e3),setTimeout(function(){a.J_gift_box.removeClass("gift_box_show").addClass("gift_box_rotate")},8e3)},text_init:function(){var a=this,b=' <img class="bg_text" src="http://xqproduct.xiangqu.com/FsWapgGpr_rrZoj_0B2OAlaiVQcR">';setTimeout(function(){a.J_wrap.append(b)},5e3)},snow_init:function(){var a=this;a.snow_img_0=new Image,a.snow_img_1=new Image,a.snow_img_2=new Image,a.snow_img_3=new Image,a.snow_img_0.src="http://xqproduct.xiangqu.com/Ft19JuXW8IMbrr3uRT8Qm5nh2MoR",a.snow_img_1.src="http://xqproduct.xiangqu.com/FglASA5GrVrrnBjYsGYoZ4oNPjf2",a.snow_img_2.src="http://xqproduct.xiangqu.com/FlLJqIJb31s2RiwQpMxJ1lvAF8mX",a.snow_img_3.src="http://xqproduct.xiangqu.com/FglASA5GrVrrnBjYsGYoZ4oNPjf2",a.sonw_img=[a.snow_img_0.src,a.snow_img_1.src,a.snow_img_2.src,a.snow_img_3.src],a.new_snow()},remove_all:function(){a(".win_show").length>50&&a(".win_show").remove()},new_snow:function(){function b(d){var e=parseInt(Math.random()*a(window).width()),f=parseInt(-50*Math.random());e>a(window).width()-22&&(e=a(window).width()-22);var g=e%8,h='<div class="win_show snow_bg_'+g+'" style="top:'+f+"px;left:"+e+'px;"></div>';c.J_wrap.append(h),c.drop_snow();setTimeout(function(){200>d&&(d=300),b(d-50)},d)}var c=this;b(1e3)},drop_snow:function(){var b=this;a(".win_show").each(function(b,c){a(this).addClass("drop");var d=a(this);setTimeout(function(){d.remove()},1e4)}),b.remove_all()},no_sign:function(a){return a?a.split("%")[0]:!1},ggl_init:function(){var c=a(".ggl").width(),d=a(".ggl").height();a(".ggl canvas").css("height",d);var e=new b(.2,c,d);e.finish(function(){e.clear()})},last_show:function(){var b=this;b.J_ggl_wrap.hide(),a(".bg_text").hide(),a(".my_nn").show().addClass("my_nn_show");setTimeout(function(){a(".my_nn").removeClass("my_nn_show").addClass("my_nn_op"),a(".ILU").show().addClass("ILU_hug")},5e3)}};a(function(){d.init()})}(Zepto);